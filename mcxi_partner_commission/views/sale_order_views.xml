<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_order_form_inherited_mcxi_partner_commission" model="ir.ui.view">
        <field name="name">sale.order.form.inherited.mcxi.partner.commission</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="mcxi_referrer_id" readonly="referrer_id != False" force_save="1" />
            </field>
            <xpath expr="//field[@name='order_line']/tree/field[@name='qty_to_invoice']" position="after">
                <field name="commission" />
            </xpath>
            <xpath expr="//field[@name='referrer_id']" position="attributes">
                <attribute name="readonly">mcxi_referrer_id != False</attribute>
                <attribute name="force_save">1</attribute>
            </xpath>
            <xpath expr="//field[@name='referrer_id']" position="after">
                <field name="agent_domain" invisible='1'/>
                <field name="agent_1_id" domain="agent_domain" options="{'no_create': True}"/>
                <field name="agent_2_id" domain="agent_domain" options="{'no_create': True}"/>
                <field name="agent_3_id" domain="agent_domain" options="{'no_create': True}"/>
            </xpath>
            <xpath expr="//tree/field[@name='product_template_id']" position="after">
                <field name="product_ids" column_invisible="1"/>
            </xpath>
            <xpath expr="//tree/field[@name='product_template_id']" position="attributes">
                <attribute name="domain">[('id', 'in', product_ids)]</attribute>
                <attribute name="options">{'no_create': True}</attribute>
            </xpath>
            <xpath expr="//page[@name='other_information']" position="after">
                <page name="commissions"  string="Commissions">
                    <field name="order_line">
                        <tree string="Commission Lines" editable="bottom">
                            <control>
                                <create name="add_product_control" string="Add a product"/>
                                <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                            </control>
                            <field name="sequence" widget="handle" />
                            <field name="product_ids" column_invisible="1"/>
                            <field name="product_template_id" widget="sol_product_many2one" string="Product" domain="[('id', 'in', product_ids)]" options="{'no_create': True}"/>
                            <field name="product_uom_qty"/>
                            <field name="commission"/>
                            <field name="agent_1_commission"/>
                            <field name="agent_2_commission"/>
                            <field name="agent_3_commission"/>
                            <field name="price_unit" />
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
    <menuitem id="menu_generate_internal_report"
        name="Generate Internal Report"
        parent="sale.menu_sale_report"
        action="action_internal_report"
        sequence="50"/>

    <menuitem id="menu_generate_external_report"
        name="Generate External Report"
        parent="sale.menu_sale_report"
        action="action_external_report"
        sequence="60"/>
</odoo>
